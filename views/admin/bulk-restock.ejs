<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/fontawesome/css/all.min.css">
  <style>
    .selected-products {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .product-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }

    .product-item:last-child {
      border-bottom: none;
    }

    .product-info {
      display: flex;
      flex-direction: column;
    }

    .product-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }

    .product-sku {
      font-size: 12px;
      color: #999;
      font-family: monospace;
    }

    .form-section {
      background: white;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .form-section h3 {
      margin: 0 0 16px 0;
      color: #333;
      font-size: 18px;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }

    .form-group small {
      color: #666;
      font-size: 12px;
      margin-top: 4px;
      display: block;
    }

    .batch-info {
      background: #e3f2fd;
      border: 1px solid #bbdefb;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 20px;
    }

    .batch-info i {
      color: #1976d2;
      margin-right: 8px;
    }

    .batch-info strong {
      color: #1976d2;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .action-buttons .btn {
      flex: 1;
    }

    @media (max-width: 768px) {
      .action-buttons {
        flex-direction: column;
      }

      .product-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <%- include('../components/sidebar', { currentPath: '/admin/inventory/stock-management' }) %>
  
  <div class="main-content">
    <div style="min-height: 100vh; background-color: var(--bg-color); padding: 32px 20px;">
      <div class="container">
        <div class="flex-between mb-3">
          <div>
            <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">
              <i class="fas fa-boxes"></i> Bulk Restock
            </h1>
            <p style="color: #666;">Restock multiple products for <strong><%= branchName %></strong></p>
          </div>
          
          <div>
            <a href="/admin/inventory/stock-management?branch=<%= branchId %>" class="btn btn-outline">
              <i class="fas fa-arrow-left"></i>
              Back to Stock Management
            </a>
          </div>
        </div>

        <% if (typeof success !== 'undefined' && success) { %>
          <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            <%= success %>
          </div>
        <% } %>
        
        <% if (typeof error !== 'undefined' && error) { %>
          <div class="alert alert-error">
            <i class="fas fa-exclamation-circle"></i>
            <%= error %>
          </div>
        <% } %>

        <!-- Selected Products -->
        <div class="selected-products">
          <h3 style="margin: 0 0 16px 0; color: #333;">
            <i class="fas fa-list"></i> Selected Products (<%= selectedProducts.length %>)
          </h3>
          
          <% selectedProducts.forEach(product => { %>
            <div class="product-item">
              <div class="product-info">
                <div class="product-name"><%= product.name %></div>
                <div class="product-sku"><%= product.sku %></div>
              </div>
            </div>
          <% }) %>
        </div>

        <!-- Restock Form -->
        <form method="POST" action="/admin/inventory/bulk-restock-process">
          <input type="hidden" name="productIds" value="<%= JSON.stringify(productIds) %>">
          <input type="hidden" name="branchId" value="<%= branchId %>">
          
          <div class="form-section">
            <h3><i class="fas fa-info-circle"></i> Restock Details</h3>
            
            <div class="batch-info">
              <i class="fas fa-barcode"></i>
              <strong>Batch Number:</strong> <span id="autoBatchNumber"><%= autoBatchNumber %></span>
              <small style="display: block; margin-top: 4px; color: #666;">
                Auto-generated based on today's date (DDMMYY format)
              </small>
            </div>

            <div class="form-group">
              <label for="quantity">
                <i class="fas fa-boxes"></i> Quantity per Product *
              </label>
              <input 
                type="number" 
                id="quantity" 
                name="quantity" 
                required 
                min="1"
                placeholder="Enter quantity to add to each product"
              >
              <small>This quantity will be added to each selected product</small>
            </div>

            <div class="form-group">
              <label for="expiryDate">
                <i class="fas fa-calendar"></i> Expiry Date *
              </label>
              <input 
                type="date" 
                id="expiryDate" 
                name="expiryDate" 
                required
                min="<%= tomorrow %>"
              >
              <small>Minimum date is tomorrow</small>
            </div>
          </div>

          <div class="action-buttons">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-check"></i> Confirm Bulk Restock
            </button>
            <a href="/admin/inventory/stock-management?branch=<%= branchId %>" class="btn btn-outline">
              <i class="fas fa-times"></i> Cancel
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <script>

    document.addEventListener('DOMContentLoaded', () => {
      const alerts = document.querySelectorAll('.alert');
      if (alerts.length > 0) {
        setTimeout(() => {
          alerts.forEach(alert => {
            alert.style.transition = 'opacity 0.5s ease';
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 500);
          });
        }, 3000);
      }
    });


    document.addEventListener('DOMContentLoaded', () => {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('expiryDate').min = tomorrow.toISOString().split('T')[0];
    });

    document.addEventListener('wheel', function (e) {
      if (document.activeElement.type === 'number') {
        document.activeElement.blur();
      }
    });
  </script>
</body>
</html>
