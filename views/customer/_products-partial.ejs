<div class="results-info">
  <p>Showing <%= products.length %> product<%= products.length !== 1 ? 's' : '' %></p>
  <% if (currentCategory || searchQuery) { %>
    <a href="/customer/shop" class="btn btn-secondary btn-sm">
      <i class="fas fa-times"></i>
      Clear Filters
    </a>
  <% } %>
</div>

<% if (products.length > 0) { %>
  <div class="products-grid">
    <% products.forEach(product => { %>
      <!-- Your product card HTML here (keep the same as before) -->
      <div class="product-card <%= product.stock_status.key === 'sold_out' ? 'sold-out' : '' %>">
        <a href="/customer/product/<%= product.id %>" class="product-link">
          <div class="product-image">
            <% if (product.image_url) { %>
              <img src="<%= product.image_url %>" alt="<%= product.name %>">
            <% } else { %>
              <div class="placeholder-image">
                <i class="fas fa-capsules"></i>
              </div>
            <% } %>
            <% if (product.requires_prescription) { %>
              <span class="prescription-badge">
                <i class="fas fa-file-prescription"></i>
                Rx
              </span>
            <% } %>
            <span class="stock-badge <%= product.stock_status.key %>" style="background-color: <%= product.stock_status.color %>; color: <%= product.stock_status.textColor %>;">
              <% if (product.stock_status.key === 'available') { %>
                <i class="fas fa-check-circle"></i>
              <% } else if (product.stock_status.key === 'sold_out') { %>
                <i class="fas fa-times-circle"></i>
              <% } else if (product.stock_status.key === 'limited') { %>
                <i class="fas fa-exclamation-triangle"></i>
              <% } %>
              <%= product.stock_status.label %>
            </span>
          </div>
          <div class="product-info">
            <% if (product.category_name) { %>
              <span class="product-category"><%= product.category_name %></span>
            <% } %>
            <h3 class="product-name"><%= product.name %></h3>
            <% if (product.manufacturer) { %>
              <p class="product-manufacturer">
                <i class="fas fa-building"></i>
                <%= product.manufacturer %>
              </p>
            <% } %>
            <% if (product.description) { %>
              <p class="product-description"><%= product.description.substring(0, 100) %><%= product.description.length > 100 ? '...' : '' %></p>
            <% } %>
            <div class="product-footer">
              <span class="product-price">$<%= parseFloat(product.unit_price).toFixed(2) %></span>
              <span class="view-details">
                View Details
                <i class="fas fa-arrow-right"></i>
              </span>
            </div>
          </div>
        </a>
        <div class="product-actions" style="padding: 0 20px 20px;">
          <% if (product.stock_status.key !== 'sold_out') { %>
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
              <div style="display: flex; align-items: center; border: 2px solid var(--border-color); border-radius: 8px; overflow: hidden;">
                <button onclick="decreaseQuantity(event, <%= product.id %>)" style="background: white; border: none; padding: 8px 12px; cursor: pointer; color: var(--accent-color); font-size: 18px; font-weight: bold; transition: background 0.2s;">
                  <i class="fas fa-minus"></i>
                </button>
                <input type="number" id="quantity-<%= product.id %>" value="1" min="1" readonly style="width: 50px; text-align: center; border: none; border-left: 2px solid var(--border-color); border-right: 2px solid var(--border-color); padding: 8px 4px; font-weight: 600; font-size: 16px;">
                <button onclick="increaseQuantity(event, <%= product.id %>)" style="background: white; border: none; padding: 8px 12px; cursor: pointer; color: var(--accent-color); font-size: 18px; font-weight: bold; transition: background 0.2s;">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>
            <div style="display: flex; gap: 8px;">
              <button class="add-to-cart-btn" 
                      onclick="addToCart(event, <%= product.id %>, '<%= product.name %>')" 
                      style="flex: 1; padding: 12px; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                <i class="fas fa-shopping-cart"></i>
                Add to Cart
              </button>
              <button class="buy-now-btn" 
                      onclick="buyNow(event, <%= product.id %>, '<%= product.name %>')" 
                      style="flex: 1; padding: 12px; background: #ff6b35; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                <i class="fas fa-bolt"></i>
                Buy Now
              </button>
            </div>
          <% } else { %>
            <button disabled style="width: 100%; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: not-allowed; opacity: 0.5;">
              <i class="fas fa-times-circle"></i>
              Out of Stock
            </button>
          <% } %>
        </div>
      </div>
    <% }) %>
  </div>
<% } else { %>
  <div class="no-results">
    <div class="no-results-content">
      <div class="no-results-icon-wrapper">
        <div class="no-results-icon-bg">
          <i class="fas fa-search"></i>
        </div>
      </div>
      <h2>No Products Found</h2>
      <p>We couldn't find any products matching your criteria. Try adjusting your filters or search terms.</p>
      <a href="/customer/shop" class="btn btn-primary">
        Browse All Products
      </a>
    </div>
  </div>
<% } %>

<script>

  (function() {

    window.selectedCategories = <%- JSON.stringify(currentCategory ? currentCategory.split(',') : []) %>;
    window.currentSort = '<%- currentSort %>';
    

    updateFilterTriggers();
    updateModalCheckboxes();
    updateSortModal();
  })();

</script>