<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/fontawesome/css/all.min.css">
  <style>
    @keyframes iconFloat {
      0% { transform: translateX(-60px) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      50% { transform: translateX(50vw) rotate(15deg); opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateX(100vw) rotate(0deg); opacity: 0; }
    }

    .fade-section {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .fade-section.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .order-header {
      background: linear-gradient(135deg, var(--accent-color), #45a049);
      color: white;
      padding: 30px;
      border-radius: 8px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }

    .floating-icons i {
      position: absolute;
      top: 20%;
      font-size: 22px;
      opacity: 0;
      color: rgba(255, 255, 255, 0.6);
      animation: iconFloat 6s linear infinite;
    }

    .floating-icons i:nth-child(1) { left: 0; animation-delay: 0s; top: 25%; }
    .floating-icons i:nth-child(2) { left: -40px; animation-delay: 1s; top: 45%; }
    .floating-icons i:nth-child(3) { left: -80px; animation-delay: 2s; top: 65%; }
    .floating-icons i:nth-child(4) { left: -120px; animation-delay: 3s; top: 35%; }
    .floating-icons i:nth-child(5) { left: -160px; animation-delay: 4s; top: 55%; }

    .order-header h1 {
      margin: 0 0 12px 0;
      font-size: 32px;
      position: relative;
      z-index: 2;
    }

    .order-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 16px;
    }

    .order-meta-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .order-meta-label {
      font-size: 12px;
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .order-meta-value {
      font-size: 18px;
      font-weight: 600;
    }

    .info-card {
      background: white;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .info-card h3 {
      margin-top: 0;
      margin-bottom: 16px;
      font-size: 18px;
      color: #333;
      border-bottom: 2px solid var(--accent-color);
      padding-bottom: 8px;
    }

    .info-row {
      display: grid;
      grid-template-columns: 150px 1fr;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }

    .info-row:last-child { border-bottom: none; }

    .info-label {
      font-weight: 600;
      color: #666;
    }

    .items-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      word-wrap: break-word;
      table-layout: fixed;
    }

    .items-table th {
      background: #f8f9fa;
      color: #000;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #ddd;
    }

    .items-table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
      word-break: break-word;
      white-space: normal;
    }

    .items-table td:nth-child(3) {
      text-align: center;
    }

    .items-table tr:last-child td { border-bottom: none; }

    .summary-box {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 15px;
    }

    .summary-row.total {
      border-top: 2px solid #333;
      margin-top: 12px;
      padding-top: 12px;
      font-size: 20px;
      font-weight: 700;
      color: var(--accent-color);
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    @media (max-width: 768px) {
      .order-header { padding: 20px; }
      .order-header h1 { font-size: 24px; }
      .order-meta { grid-template-columns: 1fr; gap: 12px; }
      .order-meta-item { text-align: center; }
      .info-card { padding: 16px; margin-bottom: 16px; }
      .info-card h3 { font-size: 16px; }
      .info-row { grid-template-columns: 1fr; gap: 4px; text-align: left; }
      .info-label { font-size: 13px; margin-bottom: 2px; }
      .items-table, .items-table thead, .items-table tbody, .items-table th, .items-table td, .items-table tr {
        display: block;
        width: 100%;
      }
      .items-table thead { display: none; }
      .items-table tr {
        margin-bottom: 15px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        padding: 10px;
      }
      .items-table td {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 8px 10px;
        border: none;
        position: relative;
        word-break: break-word;
        white-space: normal;
        gap: 6px;
      }

      .items-table td::before {
        content: attr(data-label) ":";
        font-weight: 600;
        color: #000;
        flex-shrink: 0;
      }

      .items-table td[data-label="Product"] {
        justify-content: space-between;
        text-align: right;
      }

      .items-table td[data-label="Product"] span,
      .items-table td[data-label="Product"] strong {
        margin-left: auto;
        text-align: right;
        display: inline-block;
        max-width: 70%;
        word-break: break-word;
        overflow-wrap: anywhere;
      }
      .items-table td[data-label="Quantity"],
      .items-table td[data-label="Unit Price"],
      .items-table td[data-label="Subtotal"] {
        text-align: right;
      }
      .summary-box { padding: 16px; }
      .summary-row { font-size: 14px; }
      .summary-row.total { font-size: 18px; }
      .action-buttons { flex-direction: column; gap: 8px; }
      .action-buttons .btn { width: 100%; justify-content: center; }
      .container { padding: 16px !important; }
      .info-cards-grid { grid-template-columns: 1fr !important; gap: 16px !important; }
    }
  </style>
</head>
<body>
  <%- include('../components/sidebar', { currentPath: '/employee/inventory/orders' }) %>

  <div class="main-content">
    <div style="min-height: 100vh; background-color: var(--bg-color); padding: 32px 20px;">
      <div class="container" style="max-width: 1000px;">
        <a href="<%= order.branch_id ? '/employee/inventory/orders?branch=' + order.branch_id : '/employee/inventory/incoming-orders' %>" class="back-link" style="display: inline-flex; align-items: center; gap: 8px; color: var(--accent-color); text-decoration: none; font-weight: 600; margin-bottom: 24px;">
          <i class="fas fa-arrow-left"></i> Back to <%= order.branch_id ? 'Orders' : 'Incoming Orders' %>
        </a>

        <div class="order-header fade-section">
          <div class="floating-icons">
            <i class="fas fa-stethoscope"></i>
            <i class="fas fa-user-md"></i>
            <i class="fas fa-pills"></i>
            <i class="fas fa-syringe"></i>
            <i class="fas fa-heartbeat"></i>            
          </div>
          <h1><i class="fas fa-receipt"></i> Order #<%= order.id %></h1>
          <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
            <span class="badge badge-<%= order.status === 'completed' ? 'success' : order.status === 'pending' ? 'warning' : order.status === 'cancelled' ? 'danger' : 'info' %>" style="font-size: 14px; padding: 8px 16px;"><%= order.status.toUpperCase() %></span>
            <% if (order.order_type === 'pickup') { %>
              <span class="badge badge-info" style="font-size: 14px; padding: 8px 16px;"><i class="fas fa-shopping-bag"></i> PICK UP</span>
            <% } else { %>
              <span class="badge badge-primary" style="font-size: 14px; padding: 8px 16px;"><i class="fas fa-truck"></i> DELIVERY</span>
            <% } %>
          </div>
          <div class="order-meta">
            <div class="order-meta-item">
              <span class="order-meta-label">Order Date</span>
              <span class="order-meta-value"><%= new Date(order.created_at).toLocaleString() %></span>
            </div>
            <div class="order-meta-item">
              <span class="order-meta-label">Branch</span>
              <span class="order-meta-value"><%= order.branch_name || 'Unassigned' %></span>
            </div>
            <div class="order-meta-item">
              <span class="order-meta-label">Total Amount</span>
              <span class="order-meta-value">$<%= parseFloat(order.total).toFixed(2) %></span>
            </div>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;" class="info-cards-grid">
          <div class="info-card fade-section">
            <h3><i class="fas fa-user"></i> Customer Information</h3>
            <div class="info-row"><span class="info-label">Name:</span><span><%= order.customer_name %></span></div>
            <div class="info-row"><span class="info-label">Email:</span><span><%= order.customer_email %></span></div>
            <div class="info-row"><span class="info-label">Phone:</span><span><%= order.customer_phone || 'N/A' %></span></div>
          </div>
          <div class="info-card fade-section">
            <h3><i class="fas fa-info-circle"></i> Order Information</h3>
            <div class="info-row"><span class="info-label">Created By:</span><span><%= order.created_by_name || 'N/A' %></span></div>
            <% if (order.updated_by_name) { %>
              <div class="info-row"><span class="info-label">Last Updated By:</span><span><%= order.updated_by_name %></span></div>
              <div class="info-row"><span class="info-label">Updated At:</span><span><%= new Date(order.updated_at).toLocaleString() %></span></div>
            <% } %>
          </div>
        </div>

        <% if (order.order_type === 'delivery' && order.delivery_address) { %>
          <div class="info-card fade-section">
            <h3><i class="fas fa-map-marker-alt"></i> Delivery Address</h3>
            <div class="info-row"><span class="info-label">Address:</span><span><%= order.delivery_address %></span></div>
            <div class="info-row"><span class="info-label">City:</span><span><%= order.delivery_city || 'N/A' %></span></div>
            <div class="info-row"><span class="info-label">State:</span><span><%= order.delivery_state || 'N/A' %></span></div>
            <div class="info-row"><span class="info-label">ZIP Code:</span><span><%= order.delivery_zip || 'N/A' %></span></div>
          </div>
        <% } %>

        <div class="info-card fade-section">
          <h3><i class="fas fa-shopping-cart"></i> Order Items</h3>
          <table class="items-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>SKU</th>
                <th style="text-align: center;">Quantity</th>
                <th style="text-align: right;">Unit Price</th>
                <th style="text-align: right;">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <% items.forEach(item => { %>
                <tr>
                  <td data-label="Product"><strong><%= item.product_name %></strong></td>
                  <td data-label="SKU"><code><%= item.sku %></code></td>
                  <td data-label="Quantity"><%= item.quantity %></td>
                  <td data-label="Unit Price" style="text-align: right;">$<%= parseFloat(item.unit_price).toFixed(2) %></td>
                  <td data-label="Subtotal" style="text-align: right;"><strong>$<%= parseFloat(item.subtotal).toFixed(2) %></strong></td>
                </tr>
              <% }) %>
            </tbody>
          </table>

          <div class="summary-box fade-section">
            <div class="summary-row"><span>Subtotal:</span><strong>$<%= parseFloat(order.subtotal).toFixed(2) %></strong></div>
            <div class="summary-row"><span>Tax:</span><strong>$<%= parseFloat(order.tax).toFixed(2) %></strong></div>
            <% if (order.discount > 0) { %>
              <div class="summary-row" style="color: #ff9800;">
                <span>Discount (<%= order.discount_type === 'percentage' ? order.discount + '%' : 'Fixed' %>):</span>
                <strong>
                  <% if (order.discount_type === 'percentage') { %>
                    -$<%= (parseFloat(order.subtotal) * parseFloat(order.discount) / 100).toFixed(2) %>
                  <% } else { %>
                    -$<%= parseFloat(order.discount).toFixed(2) %>
                  <% } %>
                </strong>
              </div>
            <% } %>
            <% if (order.order_type === 'delivery' && order.delivery_fee > 0) { %>
              <div class="summary-row"><span>Delivery Fee:</span><strong>$<%= parseFloat(order.delivery_fee).toFixed(2) %></strong></div>
            <% } %>
            <div class="summary-row total"><span>Total:</span><span>$<%= parseFloat(order.total).toFixed(2) %></span></div>
          </div>
        </div>

        <% if (order.notes) { %>
          <div class="info-card fade-section">
            <h3><i class="fas fa-sticky-note"></i> Notes</h3>
            <p style="margin: 0; white-space: pre-wrap;"><%= order.notes %></p>
          </div>
        <% } %>

        <div class="action-buttons fade-section">
          <a href="<%= order.branch_id ? '/employee/inventory/orders?branch=' + order.branch_id : '/employee/inventory/incoming-orders' %>" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back to <%= order.branch_id ? 'Orders' : 'Incoming Orders' %></a>
          <a href="/employee/inventory/orders/print/<%= order.id %>" target="_blank" class="btn btn-primary"><i class="fas fa-print"></i> Print Receipt</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const fadeEls = document.querySelectorAll('.fade-section');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) entry.target.classList.add('visible');
        });
      }, { threshold: 0.2 });
      fadeEls.forEach(el => observer.observe(el));
    });
  </script>
</body>
</html>

